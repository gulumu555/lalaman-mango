# PRD — 漫过 / 片刻 MomentPin（MVP：动效优先）

## 1. 产品定位
在地化表达 App：一张照片 + 3-6 秒语音（上限15秒）+ 安全轻动效模板 + 声波叠加 → 输出 MP4。
内容在“附近3km地图”中被消费；用户可匿名公开或私密；可存“漂流瓶”设定未来打开并站内通知。

## 2. 目标与成功标准（DoD）
### MVP 目标
- 跑通闭环：制作 → 发布 → 附近消费 → 回复 → 漂流瓶 → 通知 → 回看
- 冷启动可演示：成都 3km 内 >=30 条种子内容（PGC）

### Definition of Done（验收）
- 一条命令可本地启动（文档化）
- 默认附近3km地图可见聚合点 & 列表
- 点开可播放 MP4（语音 + 声波 + 动效；失败自动降级）
- 可创建并发布新内容，出现在地图/列表
- 漂流瓶可设置 open_at 并触发站内通知（支持 dev override）

## 3. 核心原则（产品约束）
- 动效优先于转绘风格；MVP 可不做风格转绘或默认关闭
- 不做 AR 实时预览
- 不做社交关系链/私信
- 互动只做 reaction + 模板回复（避免重评论区）
- 隐私优先：默认私密；匿名公开可选；位置可做模糊化
- “动错比不动更尬”：MVP 使用安全动效模板库；失败降级为静图+声波+语音
 - 2.0 必修但克制：支持后台模型切换、IP 合影、参考样图风格，但风格数量收敛

## 3.1 2.0 关键改进（延续 1.0 问题修复）
- 后台可选模型：图生图/图生视频模型可配置切换
- IP 人物合影：支持与 IP 角色同框玩法
- 参考样图风格：前端 1 张参考图，后端可选 2–4 张参考图
- 风格清单（收敛）：吉卜力 / 新海诚 / 皮克斯 / 迪士尼 / 吉米漫画 / 华风格A / 华风格B

## 4. 用户故事（User Stories）
### 创建者
- 作为用户，我想拍张照并说一句话，把此刻留在一个更有氛围的“动态静帧”里
- 作为用户，我想一键生成，不想调参；不好看就“再来一个”
- 作为用户，我想匿名公开，或者只留给自己
- 作为用户，我想把它存成漂流瓶，在未来某天自动提醒我回看

### 消费者
- 作为用户，我想在附近3km地图上看看别人留下的“片刻”
- 作为用户，我想按情绪筛选（情绪天气/标签）
- 作为用户，我想对别人的内容轻量回复（不进入长评论）

## 5. 信息架构（IA）
- 首页（地图）：附近3km + 情绪天气卡 + 中央“+”
- 列表抽屉：点聚合/点位 → 内容列表
- 播放页：MP4 播放 + reaction + 模板回复 +（可存漂流瓶）
- 漂流瓶页：漂流中 / 已开启
- 我的页：我发布的（MVP可合并到“我的”）

## 6. 关键页面与交互
### 6.1 首页地图（默认附近3km）
- 地图默认定位到用户位置，视野半径约 3km
- 展示聚合点（cluster）与热度
- 顶部/浮层：情绪天气卡（占比 + 入口）
- 底部：左（漂流瓶）、中（+创建）、右（我的）

### 6.2 创建流程（3步）
Step1 选图/拍照
- 入口：点“+”
- 允许：拍照 / 相册选择
- 可选：裁剪（最小）

Step2 选风格 + 同框伙伴
- 风格：治愈 A/B/C/D
- 同框伙伴：马年小马默认开启（可切姿态）

Step3 录语音
- 默认 3-6 秒，上限 15 秒（可重录）
- 录音UI：按住说 / 点击录（任选实现）
- 文案引导：轻旁白/祝福优先（避免默认深度倾诉）

Step3 生成与发布
- 默认应用动效模板（安全模板库）
- “再来一个”：随机切换另一个安全模板并重新预览/再生成（可以先仅换模板不重生成，视实现）
- 选择发布范围：
  - private（默认）：私密
  - public_anonymous：匿名公开
- 可选：加入漂流瓶（open_at 默认“明年春节”，但可自由改时间）
- 点击发布：进入生成进度 -> 成功后落地到播放页（并出现在地图/列表）

#### 6.2.1 动效与 MP4 输出（MVP）
- 输入：photo + audio + motion_template_id
- 渲染顺序（建议）：
  1) 图片轻动效（安全模板驱动）
  2) 音频波形叠加（底部或边缘）
  3) 音画合成输出 MP4
- 时长：以音频时长为准（3-6 秒为主，上限 15 秒）
- 失败降级：静图 + 波形 + 原音频（仍输出 MP4）

### 6.3 播放页
- 自动播放 MP4（带音频）
- 显示：标题（可为空）、情绪标签、位置（模糊到区域/POI名）
- 操作：
  - reaction：🫶 🥺 🙂 😮‍💨 ✨ 👏
  - 模板回复：从预设短句中选一个发送（不弹键盘，限频）
  - 存漂流瓶：设置 open_at（若已设置则展示状态）

### 6.4 情绪天气
- 卡片展示（可配置）：😮‍💨疲惫 / 🫧治愈 / 🙂轻松 / ✨小确幸 / 🥲emo
- 点击某情绪：过滤地图/列表内容（MVP：先过滤列表即可）

情绪标签三档（用户侧）：
- A 开心/轻松：🙂轻松 / 😄开心 / ✨小确幸 / 😂好笑
- B 平静/治愈：🍃平静 / 🫧治愈 / 💤放空 / 🌙安静
- C 疲惫/Emo：😮‍💨疲惫 / 🥲emo / 😵‍💫烦 / 😔低落

### 6.5 漂流瓶
- 列表分组：
  - 漂流中（未到 open_at）
  - 已开启（到点后可回放）
- open_at 到点：站内通知提醒
- 已开启：可播放并可“再次封存”（后置）

## 7. 内容模型（高层）
- Moment（内容单元）：photo + audio + mp4 + mood + geo + motion_template + visibility + timestamps
- Reaction：计数
- TemplateReply：轻量回复记录（可只记 count 或最新N条）
- Bottle（漂流瓶）：一组 moment_id 或单个 moment_id + open_at + status
- Notification：站内通知

## 8. 冷启动策略（MVP）
- PGC 种子内容为主：成都3km 30条，含通用治愈A/B/C/D & 马年小马主题部分条目
- 地图默认就能看见可点内容（不依赖UGC）

## 9. 风控与隐私（MVP最小）
- public_anonymous 默认匿名，不展示用户标识
- private 仅自己可见
- 位置展示：可模糊到网格/区域名（避免精确门牌）
- 举报/屏蔽入口先 stub（记录事件即可）
- 音频内容不做强审核（MVP可先做敏感词提示/上报hook）

## 10. 里程碑（与ROADMAP对齐）
- M1：创建→生成MP4→播放（本地跑通）
- M2：地图3km→聚合→列表→播放（含种子数据）
- M3：发布权限/匿名→reaction/模板回复
- M4：漂流瓶→open_at→站内通知→回看
- M5：体验打磨+上线准备

## 11. 工程与实现约束（MVP）
- 客户端：先做微信小程序 MVP；App（iOS/Android）第二阶段再做，复用同一套后端 API
- 后端：FastAPI（已 scaffold），存储先用 SQLite（本地/测试），后续可切 Postgres
- 附近查询：先用 bounding box（lat/lng + radius_m）简单过滤
- 动效模板：模板列表先写死在 docs/MOTION_TEMPLATES.md；后端只做模板 id 校验 + 原样返回
- 媒体处理：MVP 不做真实渲染管线，mp4_url 可为空或占位
- 通知机制：MVP 仅提供数据结构/接口，客户端轮询

### 11.1 渲染与降级策略
- MVP 可用占位 MP4（或服务端空实现），确保播放链路可走通
- 渲染失败时，客户端展示静图 + 波形的降级样式并提示可重试
