# 在么 MomentPin（啦啦漫2.0 Pivot）项目需求总览（给 Codex@Cursor）

## 1. 我们是谁、为什么做这个
我们从“啦啦漫1.0：AI转绘漫画 + 线下打印（UV等）纪念品”出发，验证过程中发现：
- 用户表达的刚需不一定是“做长漫画”，而是“低门槛表达此刻”。
- 风格转绘抽卡不稳定、成本高、体验不可控；动效一旦做错更尬。
- 社交场域上，微信朋友圈偏“工具化通信录”，情绪化内容不总适合发朋友圈。
因此我们把2.0定位为：先在本App内形成“表达与在地消费”的闭环，再考虑外部分发。

## 2. 产品一句话
在地化表达工具：用户在某个地点拍一张照片，留一段3-6秒语音，系统自动套用“安全动效模板 + 声波叠加”，生成一个可播放的MP4“片刻/内容单元”，发布到本App的附近3km地图（匿名公开/私密），也可存为“漂流瓶”设置未来打开并站内通知。

## 3. MVP核心原则（强约束）
- 动效优先于画面风格；风格转绘（吉卜力/皮克斯等）可后置或默认关闭。
- 不做AR实时预览（端侧AR能力先跟踪测试，但MVP不依赖它）。
- 输出统一为MP4（语音 + 声波 + 轻动效；动效失败可降级为静图+声波+语音）。
- 默认地图视野：附近3km；在地化是产品灵魂之一。
- 冷启动：以PGC种子内容为主（成都附近3km+通用治愈风格A/B/C/D+马年小马主题），UGC随后增长。
- 隐私：公开内容默认匿名；用户可选择 public_anonymous / private；位置支持模糊化。
- 互动：只做 reaction + 模板回复，避免重评论区。

## 4. 核心用户流程（MVP）
### 4.1 创建（3步）
1) 选图/拍照
2) 按住说一句（默认3-6秒，可重录）
3) 一键生成MP4（默认安全动效）-> 发布（匿名公开/私密）-> 可选存入漂流瓶（open_at默认“明年春节”，但用户可改任意时间）

### 4.2 消费（附近3km）
- 打开App默认附近3km地图
- 看到聚合点/热区，点击弹出列表
- 点开播放页：自动播放MP4，可暂停/重播
- 下方：reaction + 模板回复

### 4.3 漂流瓶
- 创建时/播放页：可加入漂流瓶并设置open_at
- 到点触发站内通知
- “漂流瓶”页显示：漂流中/已开启；已开启可回放

## 5. 内容形态与命名（暂定）
- 内容单元：Moment（片刻/记录/留言，后续可统一命名）
- 地图：附近3km + 情绪天气（占比）+ 点位聚合
- 漂流瓶：时间胶囊机制（可改名，但机制不变）
- PGC种子：成都 + 通用治愈 A/B/C/D + 马年小马同框祈福主题

## 6. 成功标准（Definition of Done）
- 一条命令可本地启动（写入README或docs）
- 成都附近3km显示>=30条种子内容（聚合点位+列表）
- 点开可播放MP4（有声音 + 声波 + 轻动效；失败自动降级）
- 可创建一条新内容并出现在地图/列表
- 可存为漂流瓶并在open_at到期触发站内通知（允许dev模拟/override）

## 7. 工程偏好（便于Codex执行）
- 配置驱动：动效模板库用JSON/配置文件描述，便于扩展
- 可观测：生成、发布、播放、通知等关键步骤都有日志
- 小步提交：每次改动少量文件，便于review和回滚

## 7.1 协作角色（固定）
- CEO：你（产品强人，洞察用户需求）
- CTO：Lucy（技术全能，负责技术方案与落地）
- 协作原则：由 CEO 定方向与需求，CTO 负责拆解与实现

## 7.2 Git 同步计划（本地 + 云端）
- 分支策略：main 保持可演示；日常开发在 dev
- 同步频率：每天至少一次 push（默认 20:00）；关键里程碑当天必同步
- 同步触发：完成单个增量（<=5 文件）后先提交到 dev，再合并到 main
- 验证前置：本地通过 smoke test 后再合并/推送
- 冲突策略：以 dev 为准，必要时手动 rebase
- 同步记录：每次推送在更新说明中标注对应增量编号

## 8. 技术栈与现状
- 客户端：先做微信小程序 MVP；App（iOS/Android）第二阶段再做，复用同一套后端 API
- 现有资产：lalaman1.0 小程序已完成，UI 与后端约定可延续以提高开发效率
- 后端：FastAPI（已 scaffold）；存储先用 SQLite（本地/测试），后续可切 Postgres
- 当前目标：Moments 的写入/读取/附近查询跑通，可用 Swagger + curl 验证

## 9. 运行方式（本地）
- 安装依赖：pip install -r backend/requirements.txt
- 启动服务：uvicorn backend.app:app --reload --port 8000
- 配置：尽量不引入复杂环境变量；必要配置写到 backend/.env.example

## 10. 媒体处理（MP4）
- MVP 暂不做真实渲染管线
- 后端先存 photo_url/audio_url/mp4_url，mp4_url 允许为空或占位
- 下一阶段再接 ffmpeg/模板渲染（服务端）

## 11. 动效模板（JSON/配置）
- MVP 模板列表先写死在 docs/MOTION_TEMPLATES.md
- 后端只做模板 id 校验 + 原样返回

## 12. 地图与定位
- MVP 不接第三方地图 SDK
- 附近查询用 bounding box（lat/lng + radius_m）做简单过滤
- 坐标系使用 WGS84

## 13. 权限与账号
- MVP 匿名/游客模式（不强制登录）
- 若需要 user_id，用 uuid 生成
- 下一阶段接微信登录（openid）

## 14. 通知机制
- MVP 只做数据结构/接口，不做推送
- 客户端轮询获取 notifications

## 15. 内容审核
- MVP 不做复杂审核
- 仅做大小/时长限制（photo/audio/mp4）+ 预留黑名单字段

## 16. 种子数据
- 使用 docs/DEMO_SEEDS_CHENGDU.md 作为 seed
- 后端提供 dev-only seed endpoint 或脚本

## 17. 指标与日志
- 结构化日志：request_id、耗时、endpoint、结果
- 不接外部监控
